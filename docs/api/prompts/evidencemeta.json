{"queries":[{"id":"prompt_overview","compiledQueryString":"SELECT\n    COUNT(DISTINCT faiw.agent_instance_tk) as total_sessions,\n    SUM(CASE WHEN faiw.agent_instance_outcome = 'success' THEN 1 ELSE 0 END) as successful_sessions,\n    ROUND(100.0 * SUM(CASE WHEN faiw.agent_instance_outcome = 'success' THEN 1 ELSE 0 END) / COUNT(DISTINCT faiw.agent_instance_tk), 1) as success_rate,\n    COUNT(DISTINCT dt.ticket_tk) as tickets_worked,\n    SUM(faic.total_token_cost_usd) as total_cost\nFROM herd.fact_agent_instance_work faiw\nLEFT JOIN herd.fact_agent_instance_cost faic\n    ON faiw.agent_instance_tk = faic.agent_instance_tk\nLEFT JOIN herd.dim_ticket dt\n    ON faiw.ticket_sk = dt.ticket_sk","inputQueryString":"SELECT\n    COUNT(DISTINCT faiw.agent_instance_tk) as total_sessions,\n    SUM(CASE WHEN faiw.agent_instance_outcome = 'success' THEN 1 ELSE 0 END) as successful_sessions,\n    ROUND(100.0 * SUM(CASE WHEN faiw.agent_instance_outcome = 'success' THEN 1 ELSE 0 END) / COUNT(DISTINCT faiw.agent_instance_tk), 1) as success_rate,\n    COUNT(DISTINCT dt.ticket_tk) as tickets_worked,\n    SUM(faic.total_token_cost_usd) as total_cost\nFROM herd.fact_agent_instance_work faiw\nLEFT JOIN herd.fact_agent_instance_cost faic\n    ON faiw.agent_instance_tk = faic.agent_instance_tk\nLEFT JOIN herd.dim_ticket dt\n    ON faiw.ticket_sk = dt.ticket_sk","compiled":false,"inline":true},{"id":"success_by_size","compiledQueryString":"SELECT\n    dt.ticket_tshirt_size,\n    COUNT(DISTINCT faiw.agent_instance_tk) as sessions,\n    SUM(CASE WHEN faiw.agent_instance_outcome = 'success' THEN 1 ELSE 0 END) as successes,\n    ROUND(100.0 * SUM(CASE WHEN faiw.agent_instance_outcome = 'success' THEN 1 ELSE 0 END) / COUNT(DISTINCT faiw.agent_instance_tk), 1) as success_rate\nFROM herd.fact_agent_instance_work faiw\nJOIN herd.dim_ticket dt\n    ON faiw.ticket_sk = dt.ticket_sk\nWHERE dt.is_current = true\n  AND NOT dt.is_deleted\n  AND dt.ticket_tshirt_size IS NOT NULL\nGROUP BY dt.ticket_tshirt_size\nORDER BY\n    CASE dt.ticket_tshirt_size\n        WHEN 'XS' THEN 1\n        WHEN 'S' THEN 2\n        WHEN 'M' THEN 3\n        WHEN 'L' THEN 4\n        WHEN 'XL' THEN 5\n        ELSE 6\n    END","inputQueryString":"SELECT\n    dt.ticket_tshirt_size,\n    COUNT(DISTINCT faiw.agent_instance_tk) as sessions,\n    SUM(CASE WHEN faiw.agent_instance_outcome = 'success' THEN 1 ELSE 0 END) as successes,\n    ROUND(100.0 * SUM(CASE WHEN faiw.agent_instance_outcome = 'success' THEN 1 ELSE 0 END) / COUNT(DISTINCT faiw.agent_instance_tk), 1) as success_rate\nFROM herd.fact_agent_instance_work faiw\nJOIN herd.dim_ticket dt\n    ON faiw.ticket_sk = dt.ticket_sk\nWHERE dt.is_current = true\n  AND NOT dt.is_deleted\n  AND dt.ticket_tshirt_size IS NOT NULL\nGROUP BY dt.ticket_tshirt_size\nORDER BY\n    CASE dt.ticket_tshirt_size\n        WHEN 'XS' THEN 1\n        WHEN 'S' THEN 2\n        WHEN 'M' THEN 3\n        WHEN 'L' THEN 4\n        WHEN 'XL' THEN 5\n        ELSE 6\n    END","compiled":false,"inline":true},{"id":"success_by_role","compiledQueryString":"SELECT\n    da.agent_role,\n    COUNT(DISTINCT faiw.agent_instance_tk) as sessions,\n    SUM(CASE WHEN faiw.agent_instance_outcome = 'success' THEN 1 ELSE 0 END) as successes,\n    ROUND(100.0 * SUM(CASE WHEN faiw.agent_instance_outcome = 'success' THEN 1 ELSE 0 END) / COUNT(DISTINCT faiw.agent_instance_tk), 1) as success_rate,\n    SUM(faic.total_token_cost_usd) as total_cost\nFROM herd.fact_agent_instance_work faiw\nJOIN herd.dim_agent da\n    ON faiw.agent_sk = da.agent_sk\nLEFT JOIN herd.fact_agent_instance_cost faic\n    ON faiw.agent_instance_tk = faic.agent_instance_tk\nWHERE da.is_current = true\n  AND NOT da.is_deleted\nGROUP BY da.agent_role\nORDER BY success_rate DESC","inputQueryString":"SELECT\n    da.agent_role,\n    COUNT(DISTINCT faiw.agent_instance_tk) as sessions,\n    SUM(CASE WHEN faiw.agent_instance_outcome = 'success' THEN 1 ELSE 0 END) as successes,\n    ROUND(100.0 * SUM(CASE WHEN faiw.agent_instance_outcome = 'success' THEN 1 ELSE 0 END) / COUNT(DISTINCT faiw.agent_instance_tk), 1) as success_rate,\n    SUM(faic.total_token_cost_usd) as total_cost\nFROM herd.fact_agent_instance_work faiw\nJOIN herd.dim_agent da\n    ON faiw.agent_sk = da.agent_sk\nLEFT JOIN herd.fact_agent_instance_cost faic\n    ON faiw.agent_instance_tk = faic.agent_instance_tk\nWHERE da.is_current = true\n  AND NOT da.is_deleted\nGROUP BY da.agent_role\nORDER BY success_rate DESC","compiled":false,"inline":true},{"id":"session_outcomes","compiledQueryString":"SELECT\n    faiw.agent_instance_outcome,\n    COUNT(*) as count,\n    SUM(faic.total_token_cost_usd) as total_cost,\n    ROUND(AVG(faiw.instance_duration_minutes), 1) as avg_duration\nFROM herd.fact_agent_instance_work faiw\nLEFT JOIN herd.fact_agent_instance_cost faic\n    ON faiw.agent_instance_tk = faic.agent_instance_tk\nWHERE faiw.agent_instance_outcome IS NOT NULL\nGROUP BY faiw.agent_instance_outcome\nORDER BY count DESC","inputQueryString":"SELECT\n    faiw.agent_instance_outcome,\n    COUNT(*) as count,\n    SUM(faic.total_token_cost_usd) as total_cost,\n    ROUND(AVG(faiw.instance_duration_minutes), 1) as avg_duration\nFROM herd.fact_agent_instance_work faiw\nLEFT JOIN herd.fact_agent_instance_cost faic\n    ON faiw.agent_instance_tk = faic.agent_instance_tk\nWHERE faiw.agent_instance_outcome IS NOT NULL\nGROUP BY faiw.agent_instance_outcome\nORDER BY count DESC","compiled":false,"inline":true},{"id":"craft_impact","compiledQueryString":"SELECT\n    dc.craft_code,\n    dc.craft_description,\n    COUNT(DISTINCT faiw.agent_instance_tk) as sessions,\n    SUM(CASE WHEN faiw.agent_instance_outcome = 'success' THEN 1 ELSE 0 END) as successes,\n    ROUND(100.0 * SUM(CASE WHEN faiw.agent_instance_outcome = 'success' THEN 1 ELSE 0 END) / COUNT(DISTINCT faiw.agent_instance_tk), 1) as success_rate\nFROM herd.fact_agent_instance_work faiw\nJOIN herd.dim_craft dc\n    ON faiw.craft_sk = dc.craft_sk\nGROUP BY dc.craft_code, dc.craft_description\nORDER BY success_rate DESC","inputQueryString":"SELECT\n    dc.craft_code,\n    dc.craft_description,\n    COUNT(DISTINCT faiw.agent_instance_tk) as sessions,\n    SUM(CASE WHEN faiw.agent_instance_outcome = 'success' THEN 1 ELSE 0 END) as successes,\n    ROUND(100.0 * SUM(CASE WHEN faiw.agent_instance_outcome = 'success' THEN 1 ELSE 0 END) / COUNT(DISTINCT faiw.agent_instance_tk), 1) as success_rate\nFROM herd.fact_agent_instance_work faiw\nJOIN herd.dim_craft dc\n    ON faiw.craft_sk = dc.craft_sk\nGROUP BY dc.craft_code, dc.craft_description\nORDER BY success_rate DESC","compiled":false,"inline":true},{"id":"success_trend","compiledQueryString":"SELECT\n    dd.date_actual as date,\n    COUNT(DISTINCT faiw.agent_instance_tk) as sessions,\n    SUM(CASE WHEN faiw.agent_instance_outcome = 'success' THEN 1 ELSE 0 END) as successes,\n    ROUND(100.0 * SUM(CASE WHEN faiw.agent_instance_outcome = 'success' THEN 1 ELSE 0 END) / NULLIF(COUNT(DISTINCT faiw.agent_instance_tk), 0), 1) as success_rate\nFROM herd.dim_date dd\nLEFT JOIN herd.fact_agent_instance_work faiw\n    ON CAST(strftime(faiw.agent_instance_started_at, '%Y%m%d') AS INTEGER) = dd.date_sk\nWHERE dd.date_actual >= CURRENT_DATE - INTERVAL '30 days'\n  AND dd.date_actual <= CURRENT_DATE\nGROUP BY dd.date_actual\nORDER BY dd.date_actual","inputQueryString":"SELECT\n    dd.date_actual as date,\n    COUNT(DISTINCT faiw.agent_instance_tk) as sessions,\n    SUM(CASE WHEN faiw.agent_instance_outcome = 'success' THEN 1 ELSE 0 END) as successes,\n    ROUND(100.0 * SUM(CASE WHEN faiw.agent_instance_outcome = 'success' THEN 1 ELSE 0 END) / NULLIF(COUNT(DISTINCT faiw.agent_instance_tk), 0), 1) as success_rate\nFROM herd.dim_date dd\nLEFT JOIN herd.fact_agent_instance_work faiw\n    ON CAST(strftime(faiw.agent_instance_started_at, '%Y%m%d') AS INTEGER) = dd.date_sk\nWHERE dd.date_actual >= CURRENT_DATE - INTERVAL '30 days'\n  AND dd.date_actual <= CURRENT_DATE\nGROUP BY dd.date_actual\nORDER BY dd.date_actual","compiled":false,"inline":true},{"id":"qa_prompt_correlation","compiledQueryString":"WITH first_session_per_ticket AS (\n    SELECT\n        dt.ticket_tk,\n        dt.ticket_code,\n        faiw.agent_instance_tk,\n        faiw.agent_instance_outcome,\n        ROW_NUMBER() OVER (PARTITION BY dt.ticket_tk ORDER BY faiw.agent_instance_started_at) as rn\n    FROM herd.dim_ticket dt\n    JOIN herd.fact_agent_instance_work faiw\n        ON dt.ticket_sk = faiw.ticket_sk\n    WHERE dt.is_current = true\n      AND NOT dt.is_deleted\n),\nfirst_review_per_ticket AS (\n    SELECT\n        fpd.ticket_sk,\n        frq.review_round,\n        frq.review_verdict,\n        ROW_NUMBER() OVER (PARTITION BY fpd.ticket_sk ORDER BY frq.review_completed_at) as rn\n    FROM herd.fact_review_quality frq\n    JOIN herd.fact_pr_delivery fpd\n        ON frq.pull_request_sk = fpd.pull_request_sk\n)\nSELECT\n    fs.agent_instance_outcome as prompt_quality,\n    COUNT(*) as ticket_count,\n    SUM(CASE WHEN fr.review_round = 1 AND fr.review_verdict = 'approved' THEN 1 ELSE 0 END) as first_pass_qa,\n    ROUND(100.0 * SUM(CASE WHEN fr.review_round = 1 AND fr.review_verdict = 'approved' THEN 1 ELSE 0 END) / COUNT(*), 1) as first_pass_rate\nFROM first_session_per_ticket fs\nLEFT JOIN first_review_per_ticket fr\n    ON fs.ticket_tk = fr.ticket_sk\n    AND fr.rn = 1\nWHERE fs.rn = 1\n  AND fs.agent_instance_outcome IS NOT NULL\nGROUP BY fs.agent_instance_outcome\nORDER BY first_pass_rate DESC","inputQueryString":"WITH first_session_per_ticket AS (\n    SELECT\n        dt.ticket_tk,\n        dt.ticket_code,\n        faiw.agent_instance_tk,\n        faiw.agent_instance_outcome,\n        ROW_NUMBER() OVER (PARTITION BY dt.ticket_tk ORDER BY faiw.agent_instance_started_at) as rn\n    FROM herd.dim_ticket dt\n    JOIN herd.fact_agent_instance_work faiw\n        ON dt.ticket_sk = faiw.ticket_sk\n    WHERE dt.is_current = true\n      AND NOT dt.is_deleted\n),\nfirst_review_per_ticket AS (\n    SELECT\n        fpd.ticket_sk,\n        frq.review_round,\n        frq.review_verdict,\n        ROW_NUMBER() OVER (PARTITION BY fpd.ticket_sk ORDER BY frq.review_completed_at) as rn\n    FROM herd.fact_review_quality frq\n    JOIN herd.fact_pr_delivery fpd\n        ON frq.pull_request_sk = fpd.pull_request_sk\n)\nSELECT\n    fs.agent_instance_outcome as prompt_quality,\n    COUNT(*) as ticket_count,\n    SUM(CASE WHEN fr.review_round = 1 AND fr.review_verdict = 'approved' THEN 1 ELSE 0 END) as first_pass_qa,\n    ROUND(100.0 * SUM(CASE WHEN fr.review_round = 1 AND fr.review_verdict = 'approved' THEN 1 ELSE 0 END) / COUNT(*), 1) as first_pass_rate\nFROM first_session_per_ticket fs\nLEFT JOIN first_review_per_ticket fr\n    ON fs.ticket_tk = fr.ticket_sk\n    AND fr.rn = 1\nWHERE fs.rn = 1\n  AND fs.agent_instance_outcome IS NOT NULL\nGROUP BY fs.agent_instance_outcome\nORDER BY first_pass_rate DESC","compiled":false,"inline":true},{"id":"model_outcomes","compiledQueryString":"SELECT\n    dm.model_code,\n    COUNT(DISTINCT faiw.agent_instance_tk) as sessions,\n    SUM(CASE WHEN faiw.agent_instance_outcome = 'success' THEN 1 ELSE 0 END) as successes,\n    ROUND(100.0 * SUM(CASE WHEN faiw.agent_instance_outcome = 'success' THEN 1 ELSE 0 END) / COUNT(DISTINCT faiw.agent_instance_tk), 1) as success_rate,\n    SUM(faic.total_token_cost_usd) as total_cost\nFROM herd.fact_agent_instance_work faiw\nJOIN herd.dim_model dm\n    ON faiw.model_sk = dm.model_sk\nLEFT JOIN herd.fact_agent_instance_cost faic\n    ON faiw.agent_instance_tk = faic.agent_instance_tk\nGROUP BY dm.model_code\nORDER BY success_rate DESC","inputQueryString":"SELECT\n    dm.model_code,\n    COUNT(DISTINCT faiw.agent_instance_tk) as sessions,\n    SUM(CASE WHEN faiw.agent_instance_outcome = 'success' THEN 1 ELSE 0 END) as successes,\n    ROUND(100.0 * SUM(CASE WHEN faiw.agent_instance_outcome = 'success' THEN 1 ELSE 0 END) / COUNT(DISTINCT faiw.agent_instance_tk), 1) as success_rate,\n    SUM(faic.total_token_cost_usd) as total_cost\nFROM herd.fact_agent_instance_work faiw\nJOIN herd.dim_model dm\n    ON faiw.model_sk = dm.model_sk\nLEFT JOIN herd.fact_agent_instance_cost faic\n    ON faiw.agent_instance_tk = faic.agent_instance_tk\nGROUP BY dm.model_code\nORDER BY success_rate DESC","compiled":false,"inline":true}]}