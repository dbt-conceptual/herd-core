{"queries":[{"id":"efficiency_overview","compiledQueryString":"SELECT\n    COUNT(DISTINCT faiw.agent_instance_tk) as total_sessions,\n    ROUND(AVG(faiw.instance_duration_minutes), 1) as avg_session_minutes,\n    SUM(faiw.lifecycle_event_count) as total_lifecycle_events,\n    SUM(faiw.ticket_activity_count) as total_ticket_activities,\n    SUM(faiw.pr_activity_count) as total_pr_activities,\n    ROUND(AVG(faiw.lifecycle_event_count), 1) as avg_lifecycle_per_session,\n    ROUND(AVG(faiw.ticket_activity_count), 1) as avg_ticket_activity_per_session\nFROM herd.fact_agent_instance_work faiw","inputQueryString":"SELECT\n    COUNT(DISTINCT faiw.agent_instance_tk) as total_sessions,\n    ROUND(AVG(faiw.instance_duration_minutes), 1) as avg_session_minutes,\n    SUM(faiw.lifecycle_event_count) as total_lifecycle_events,\n    SUM(faiw.ticket_activity_count) as total_ticket_activities,\n    SUM(faiw.pr_activity_count) as total_pr_activities,\n    ROUND(AVG(faiw.lifecycle_event_count), 1) as avg_lifecycle_per_session,\n    ROUND(AVG(faiw.ticket_activity_count), 1) as avg_ticket_activity_per_session\nFROM herd.fact_agent_instance_work faiw","compiled":false,"inline":true},{"id":"session_productivity","compiledQueryString":"SELECT\n    da.agent_code,\n    da.agent_role,\n    COUNT(DISTINCT faiw.agent_instance_tk) as sessions,\n    ROUND(AVG(faiw.instance_duration_minutes), 1) as avg_duration,\n    ROUND(AVG(faiw.lifecycle_event_count), 1) as avg_lifecycle_events,\n    ROUND(AVG(faiw.ticket_activity_count), 1) as avg_ticket_activities,\n    ROUND(AVG(faiw.pr_activity_count), 1) as avg_pr_activities,\n    ROUND(AVG(faiw.lifecycle_event_count + faiw.ticket_activity_count + faiw.pr_activity_count), 1) as avg_total_activity\nFROM herd.fact_agent_instance_work faiw\nJOIN herd.dim_agent da\n    ON faiw.agent_sk = da.agent_sk\nWHERE da.is_current = true\n  AND NOT da.is_deleted\nGROUP BY da.agent_code, da.agent_role\nORDER BY avg_total_activity DESC","inputQueryString":"SELECT\n    da.agent_code,\n    da.agent_role,\n    COUNT(DISTINCT faiw.agent_instance_tk) as sessions,\n    ROUND(AVG(faiw.instance_duration_minutes), 1) as avg_duration,\n    ROUND(AVG(faiw.lifecycle_event_count), 1) as avg_lifecycle_events,\n    ROUND(AVG(faiw.ticket_activity_count), 1) as avg_ticket_activities,\n    ROUND(AVG(faiw.pr_activity_count), 1) as avg_pr_activities,\n    ROUND(AVG(faiw.lifecycle_event_count + faiw.ticket_activity_count + faiw.pr_activity_count), 1) as avg_total_activity\nFROM herd.fact_agent_instance_work faiw\nJOIN herd.dim_agent da\n    ON faiw.agent_sk = da.agent_sk\nWHERE da.is_current = true\n  AND NOT da.is_deleted\nGROUP BY da.agent_code, da.agent_role\nORDER BY avg_total_activity DESC","compiled":false,"inline":true},{"id":"context_utilization","compiledQueryString":"SELECT\n    da.agent_code,\n    dm.model_code,\n    dm.model_context_window,\n    COUNT(DISTINCT faic.agent_instance_tk) as sessions,\n    ROUND(AVG(faic.total_token_input_count + faic.total_token_output_count), 0) as avg_tokens_per_session,\n    ROUND(100.0 * AVG(faic.total_token_input_count + faic.total_token_output_count) / dm.model_context_window, 1) as context_utilization_pct\nFROM herd.fact_agent_instance_cost faic\nJOIN herd.dim_agent da\n    ON faic.agent_sk = da.agent_sk\nJOIN herd.dim_model dm\n    ON faic.model_sk = dm.model_sk\nWHERE da.is_current = true\n  AND NOT da.is_deleted\nGROUP BY da.agent_code, dm.model_code, dm.model_context_window\nORDER BY context_utilization_pct DESC","inputQueryString":"SELECT\n    da.agent_code,\n    dm.model_code,\n    dm.model_context_window,\n    COUNT(DISTINCT faic.agent_instance_tk) as sessions,\n    ROUND(AVG(faic.total_token_input_count + faic.total_token_output_count), 0) as avg_tokens_per_session,\n    ROUND(100.0 * AVG(faic.total_token_input_count + faic.total_token_output_count) / dm.model_context_window, 1) as context_utilization_pct\nFROM herd.fact_agent_instance_cost faic\nJOIN herd.dim_agent da\n    ON faic.agent_sk = da.agent_sk\nJOIN herd.dim_model dm\n    ON faic.model_sk = dm.model_sk\nWHERE da.is_current = true\n  AND NOT da.is_deleted\nGROUP BY da.agent_code, dm.model_code, dm.model_context_window\nORDER BY context_utilization_pct DESC","compiled":false,"inline":true},{"id":"cache_hit_rate","compiledQueryString":"SELECT\n    da.agent_code,\n    COUNT(DISTINCT faic.agent_instance_tk) as sessions,\n    SUM(faic.total_token_input_count + faic.total_token_output_count) as direct_tokens,\n    SUM(faic.total_token_cache_read_count) as cache_read_tokens,\n    SUM(faic.total_token_cache_create_count) as cache_create_tokens,\n    ROUND(100.0 * SUM(faic.total_token_cache_read_count) /\n        NULLIF(SUM(faic.total_token_input_count + faic.total_token_output_count + faic.total_token_cache_read_count), 0), 1) as cache_hit_rate\nFROM herd.fact_agent_instance_cost faic\nJOIN herd.dim_agent da\n    ON faic.agent_sk = da.agent_sk\nWHERE da.is_current = true\n  AND NOT da.is_deleted\nGROUP BY da.agent_code\nORDER BY cache_hit_rate DESC NULLS LAST","inputQueryString":"SELECT\n    da.agent_code,\n    COUNT(DISTINCT faic.agent_instance_tk) as sessions,\n    SUM(faic.total_token_input_count + faic.total_token_output_count) as direct_tokens,\n    SUM(faic.total_token_cache_read_count) as cache_read_tokens,\n    SUM(faic.total_token_cache_create_count) as cache_create_tokens,\n    ROUND(100.0 * SUM(faic.total_token_cache_read_count) /\n        NULLIF(SUM(faic.total_token_input_count + faic.total_token_output_count + faic.total_token_cache_read_count), 0), 1) as cache_hit_rate\nFROM herd.fact_agent_instance_cost faic\nJOIN herd.dim_agent da\n    ON faic.agent_sk = da.agent_sk\nWHERE da.is_current = true\n  AND NOT da.is_deleted\nGROUP BY da.agent_code\nORDER BY cache_hit_rate DESC NULLS LAST","compiled":false,"inline":true},{"id":"duration_distribution","compiledQueryString":"SELECT\n    CASE\n        WHEN faiw.instance_duration_minutes < 5 THEN '< 5 min'\n        WHEN faiw.instance_duration_minutes < 15 THEN '5-15 min'\n        WHEN faiw.instance_duration_minutes < 30 THEN '15-30 min'\n        WHEN faiw.instance_duration_minutes < 60 THEN '30-60 min'\n        ELSE '60+ min'\n    END as duration_bucket,\n    COUNT(*) as session_count,\n    ROUND(AVG(faiw.lifecycle_event_count + faiw.ticket_activity_count + faiw.pr_activity_count), 1) as avg_activity\nFROM herd.fact_agent_instance_work faiw\nWHERE faiw.instance_duration_minutes IS NOT NULL\nGROUP BY duration_bucket\nORDER BY\n    CASE duration_bucket\n        WHEN '< 5 min' THEN 1\n        WHEN '5-15 min' THEN 2\n        WHEN '15-30 min' THEN 3\n        WHEN '30-60 min' THEN 4\n        ELSE 5\n    END","inputQueryString":"SELECT\n    CASE\n        WHEN faiw.instance_duration_minutes < 5 THEN '< 5 min'\n        WHEN faiw.instance_duration_minutes < 15 THEN '5-15 min'\n        WHEN faiw.instance_duration_minutes < 30 THEN '15-30 min'\n        WHEN faiw.instance_duration_minutes < 60 THEN '30-60 min'\n        ELSE '60+ min'\n    END as duration_bucket,\n    COUNT(*) as session_count,\n    ROUND(AVG(faiw.lifecycle_event_count + faiw.ticket_activity_count + faiw.pr_activity_count), 1) as avg_activity\nFROM herd.fact_agent_instance_work faiw\nWHERE faiw.instance_duration_minutes IS NOT NULL\nGROUP BY duration_bucket\nORDER BY\n    CASE duration_bucket\n        WHEN '< 5 min' THEN 1\n        WHEN '5-15 min' THEN 2\n        WHEN '15-30 min' THEN 3\n        WHEN '30-60 min' THEN 4\n        ELSE 5\n    END","compiled":false,"inline":true},{"id":"token_efficiency","compiledQueryString":"SELECT\n    da.agent_code,\n    COUNT(DISTINCT faiw.agent_instance_tk) as sessions,\n    SUM(faiw.lifecycle_event_count + faiw.ticket_activity_count + faiw.pr_activity_count) as total_activities,\n    SUM(faic.total_token_cost_usd) as total_cost,\n    CASE\n        WHEN SUM(faiw.lifecycle_event_count + faiw.ticket_activity_count + faiw.pr_activity_count) > 0\n        THEN SUM(faic.total_token_cost_usd) / SUM(faiw.lifecycle_event_count + faiw.ticket_activity_count + faiw.pr_activity_count)\n        ELSE 0\n    END as cost_per_activity\nFROM herd.fact_agent_instance_work faiw\nJOIN herd.dim_agent da\n    ON faiw.agent_sk = da.agent_sk\nLEFT JOIN herd.fact_agent_instance_cost faic\n    ON faiw.agent_instance_tk = faic.agent_instance_tk\nWHERE da.is_current = true\n  AND NOT da.is_deleted\nGROUP BY da.agent_code\nHAVING SUM(faiw.lifecycle_event_count + faiw.ticket_activity_count + faiw.pr_activity_count) > 0\nORDER BY cost_per_activity ASC","inputQueryString":"SELECT\n    da.agent_code,\n    COUNT(DISTINCT faiw.agent_instance_tk) as sessions,\n    SUM(faiw.lifecycle_event_count + faiw.ticket_activity_count + faiw.pr_activity_count) as total_activities,\n    SUM(faic.total_token_cost_usd) as total_cost,\n    CASE\n        WHEN SUM(faiw.lifecycle_event_count + faiw.ticket_activity_count + faiw.pr_activity_count) > 0\n        THEN SUM(faic.total_token_cost_usd) / SUM(faiw.lifecycle_event_count + faiw.ticket_activity_count + faiw.pr_activity_count)\n        ELSE 0\n    END as cost_per_activity\nFROM herd.fact_agent_instance_work faiw\nJOIN herd.dim_agent da\n    ON faiw.agent_sk = da.agent_sk\nLEFT JOIN herd.fact_agent_instance_cost faic\n    ON faiw.agent_instance_tk = faic.agent_instance_tk\nWHERE da.is_current = true\n  AND NOT da.is_deleted\nGROUP BY da.agent_code\nHAVING SUM(faiw.lifecycle_event_count + faiw.ticket_activity_count + faiw.pr_activity_count) > 0\nORDER BY cost_per_activity ASC","compiled":false,"inline":true},{"id":"compaction_opportunities","compiledQueryString":"WITH session_stats AS (\n    SELECT\n        faiw.agent_instance_tk,\n        da.agent_code,\n        faiw.instance_duration_minutes,\n        faiw.lifecycle_event_count + faiw.ticket_activity_count + faiw.pr_activity_count as total_activity,\n        faic.total_token_input_count + faic.total_token_output_count as total_tokens\n    FROM herd.fact_agent_instance_work faiw\n    JOIN herd.dim_agent da\n        ON faiw.agent_sk = da.agent_sk\n    LEFT JOIN herd.fact_agent_instance_cost faic\n        ON faiw.agent_instance_tk = faic.agent_instance_tk\n    WHERE da.is_current = true\n      AND NOT da.is_deleted\n      AND faiw.instance_duration_minutes IS NOT NULL\n)\nSELECT\n    agent_code,\n    COUNT(*) as low_efficiency_sessions,\n    ROUND(AVG(instance_duration_minutes), 1) as avg_duration,\n    ROUND(AVG(total_activity), 1) as avg_activity,\n    ROUND(AVG(total_tokens), 0) as avg_tokens\nFROM session_stats\nWHERE instance_duration_minutes > 30\n  AND total_activity < 5\nGROUP BY agent_code\nORDER BY low_efficiency_sessions DESC","inputQueryString":"WITH session_stats AS (\n    SELECT\n        faiw.agent_instance_tk,\n        da.agent_code,\n        faiw.instance_duration_minutes,\n        faiw.lifecycle_event_count + faiw.ticket_activity_count + faiw.pr_activity_count as total_activity,\n        faic.total_token_input_count + faic.total_token_output_count as total_tokens\n    FROM herd.fact_agent_instance_work faiw\n    JOIN herd.dim_agent da\n        ON faiw.agent_sk = da.agent_sk\n    LEFT JOIN herd.fact_agent_instance_cost faic\n        ON faiw.agent_instance_tk = faic.agent_instance_tk\n    WHERE da.is_current = true\n      AND NOT da.is_deleted\n      AND faiw.instance_duration_minutes IS NOT NULL\n)\nSELECT\n    agent_code,\n    COUNT(*) as low_efficiency_sessions,\n    ROUND(AVG(instance_duration_minutes), 1) as avg_duration,\n    ROUND(AVG(total_activity), 1) as avg_activity,\n    ROUND(AVG(total_tokens), 0) as avg_tokens\nFROM session_stats\nWHERE instance_duration_minutes > 30\n  AND total_activity < 5\nGROUP BY agent_code\nORDER BY low_efficiency_sessions DESC","compiled":false,"inline":true},{"id":"activity_type_distribution","compiledQueryString":"SELECT\n    'Lifecycle Events' as activity_type,\n    SUM(faiw.lifecycle_event_count) as total_count,\n    ROUND(AVG(faiw.lifecycle_event_count), 1) as avg_per_session\nFROM herd.fact_agent_instance_work faiw\nUNION ALL\nSELECT\n    'Ticket Activities' as activity_type,\n    SUM(faiw.ticket_activity_count) as total_count,\n    ROUND(AVG(faiw.ticket_activity_count), 1) as avg_per_session\nFROM herd.fact_agent_instance_work faiw\nUNION ALL\nSELECT\n    'PR Activities' as activity_type,\n    SUM(faiw.pr_activity_count) as total_count,\n    ROUND(AVG(faiw.pr_activity_count), 1) as avg_per_session\nFROM herd.fact_agent_instance_work faiw\nORDER BY total_count DESC","inputQueryString":"SELECT\n    'Lifecycle Events' as activity_type,\n    SUM(faiw.lifecycle_event_count) as total_count,\n    ROUND(AVG(faiw.lifecycle_event_count), 1) as avg_per_session\nFROM herd.fact_agent_instance_work faiw\nUNION ALL\nSELECT\n    'Ticket Activities' as activity_type,\n    SUM(faiw.ticket_activity_count) as total_count,\n    ROUND(AVG(faiw.ticket_activity_count), 1) as avg_per_session\nFROM herd.fact_agent_instance_work faiw\nUNION ALL\nSELECT\n    'PR Activities' as activity_type,\n    SUM(faiw.pr_activity_count) as total_count,\n    ROUND(AVG(faiw.pr_activity_count), 1) as avg_per_session\nFROM herd.fact_agent_instance_work faiw\nORDER BY total_count DESC","compiled":false,"inline":true},{"id":"efficiency_trend","compiledQueryString":"SELECT\n    dd.date_actual as date,\n    COUNT(DISTINCT faiw.agent_instance_tk) as sessions,\n    ROUND(AVG(faiw.lifecycle_event_count + faiw.ticket_activity_count + faiw.pr_activity_count), 1) as avg_activity,\n    ROUND(AVG(faiw.instance_duration_minutes), 1) as avg_duration,\n    ROUND(AVG(faiw.lifecycle_event_count + faiw.ticket_activity_count + faiw.pr_activity_count) /\n        NULLIF(AVG(faiw.instance_duration_minutes), 0) * 60, 2) as activities_per_hour\nFROM herd.dim_date dd\nLEFT JOIN herd.fact_agent_instance_work faiw\n    ON CAST(strftime(faiw.agent_instance_started_at, '%Y%m%d') AS INTEGER) = dd.date_sk\nWHERE dd.date_actual >= CURRENT_DATE - INTERVAL '30 days'\n  AND dd.date_actual <= CURRENT_DATE\nGROUP BY dd.date_actual\nORDER BY dd.date_actual","inputQueryString":"SELECT\n    dd.date_actual as date,\n    COUNT(DISTINCT faiw.agent_instance_tk) as sessions,\n    ROUND(AVG(faiw.lifecycle_event_count + faiw.ticket_activity_count + faiw.pr_activity_count), 1) as avg_activity,\n    ROUND(AVG(faiw.instance_duration_minutes), 1) as avg_duration,\n    ROUND(AVG(faiw.lifecycle_event_count + faiw.ticket_activity_count + faiw.pr_activity_count) /\n        NULLIF(AVG(faiw.instance_duration_minutes), 0) * 60, 2) as activities_per_hour\nFROM herd.dim_date dd\nLEFT JOIN herd.fact_agent_instance_work faiw\n    ON CAST(strftime(faiw.agent_instance_started_at, '%Y%m%d') AS INTEGER) = dd.date_sk\nWHERE dd.date_actual >= CURRENT_DATE - INTERVAL '30 days'\n  AND dd.date_actual <= CURRENT_DATE\nGROUP BY dd.date_actual\nORDER BY dd.date_actual","compiled":false,"inline":true}]}