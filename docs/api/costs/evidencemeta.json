{"queries":[{"id":"cost_summary","compiledQueryString":"SELECT\n    SUM(faic.total_token_cost_usd) as total_cost,\n    SUM(faic.total_token_input_count + faic.total_token_output_count) as total_tokens,\n    COUNT(DISTINCT faic.agent_instance_tk) as total_sessions,\n    COUNT(DISTINCT dt.ticket_tk) as tickets_worked,\n    ROUND(SUM(faic.total_token_cost_usd) / NULLIF(COUNT(DISTINCT dt.ticket_tk), 0), 2) as cost_per_ticket,\n    ROUND(SUM(faic.total_token_cost_usd) / NULLIF(COUNT(DISTINCT faic.agent_instance_tk), 0), 4) as cost_per_session\nFROM herd.fact_agent_instance_cost faic\nLEFT JOIN herd.dim_ticket dt\n    ON faic.ticket_sk = dt.ticket_sk","inputQueryString":"SELECT\n    SUM(faic.total_token_cost_usd) as total_cost,\n    SUM(faic.total_token_input_count + faic.total_token_output_count) as total_tokens,\n    COUNT(DISTINCT faic.agent_instance_tk) as total_sessions,\n    COUNT(DISTINCT dt.ticket_tk) as tickets_worked,\n    ROUND(SUM(faic.total_token_cost_usd) / NULLIF(COUNT(DISTINCT dt.ticket_tk), 0), 2) as cost_per_ticket,\n    ROUND(SUM(faic.total_token_cost_usd) / NULLIF(COUNT(DISTINCT faic.agent_instance_tk), 0), 4) as cost_per_session\nFROM herd.fact_agent_instance_cost faic\nLEFT JOIN herd.dim_ticket dt\n    ON faic.ticket_sk = dt.ticket_sk","compiled":false,"inline":true},{"id":"daily_cost","compiledQueryString":"SELECT\n    dd.date_actual as date,\n    COALESCE(SUM(faic.total_token_cost_usd), 0) as daily_cost,\n    SUM(COALESCE(SUM(faic.total_token_cost_usd), 0)) OVER (\n        ORDER BY dd.date_actual\n        ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW\n    ) as cumulative_cost\nFROM herd.dim_date dd\nLEFT JOIN herd.fact_agent_instance_work faiw\n    ON CAST(strftime(faiw.agent_instance_started_at, '%Y%m%d') AS INTEGER) = dd.date_sk\nLEFT JOIN herd.fact_agent_instance_cost faic\n    ON faiw.agent_instance_tk = faic.agent_instance_tk\nWHERE dd.date_actual >= CURRENT_DATE - INTERVAL '60 days'\n  AND dd.date_actual <= CURRENT_DATE\nGROUP BY dd.date_actual\nORDER BY dd.date_actual","inputQueryString":"SELECT\n    dd.date_actual as date,\n    COALESCE(SUM(faic.total_token_cost_usd), 0) as daily_cost,\n    SUM(COALESCE(SUM(faic.total_token_cost_usd), 0)) OVER (\n        ORDER BY dd.date_actual\n        ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW\n    ) as cumulative_cost\nFROM herd.dim_date dd\nLEFT JOIN herd.fact_agent_instance_work faiw\n    ON CAST(strftime(faiw.agent_instance_started_at, '%Y%m%d') AS INTEGER) = dd.date_sk\nLEFT JOIN herd.fact_agent_instance_cost faic\n    ON faiw.agent_instance_tk = faic.agent_instance_tk\nWHERE dd.date_actual >= CURRENT_DATE - INTERVAL '60 days'\n  AND dd.date_actual <= CURRENT_DATE\nGROUP BY dd.date_actual\nORDER BY dd.date_actual","compiled":false,"inline":true},{"id":"cost_by_model","compiledQueryString":"SELECT\n    dm.model_code,\n    dm.model_provider,\n    COUNT(DISTINCT faic.agent_instance_tk) as sessions,\n    SUM(faic.total_token_input_count) as input_tokens,\n    SUM(faic.total_token_output_count) as output_tokens,\n    SUM(faic.total_token_cache_read_count) as cache_read_tokens,\n    SUM(faic.total_token_cache_create_count) as cache_create_tokens,\n    SUM(faic.total_token_cost_usd) as total_cost,\n    ROUND(AVG(faic.total_token_cost_usd), 4) as avg_cost_per_session\nFROM herd.fact_agent_instance_cost faic\nJOIN herd.dim_model dm\n    ON faic.model_sk = dm.model_sk\nGROUP BY dm.model_code, dm.model_provider\nORDER BY total_cost DESC","inputQueryString":"SELECT\n    dm.model_code,\n    dm.model_provider,\n    COUNT(DISTINCT faic.agent_instance_tk) as sessions,\n    SUM(faic.total_token_input_count) as input_tokens,\n    SUM(faic.total_token_output_count) as output_tokens,\n    SUM(faic.total_token_cache_read_count) as cache_read_tokens,\n    SUM(faic.total_token_cache_create_count) as cache_create_tokens,\n    SUM(faic.total_token_cost_usd) as total_cost,\n    ROUND(AVG(faic.total_token_cost_usd), 4) as avg_cost_per_session\nFROM herd.fact_agent_instance_cost faic\nJOIN herd.dim_model dm\n    ON faic.model_sk = dm.model_sk\nGROUP BY dm.model_code, dm.model_provider\nORDER BY total_cost DESC","compiled":false,"inline":true},{"id":"cache_efficiency","compiledQueryString":"SELECT\n    dd.date_actual as date,\n    SUM(faic.total_token_input_count + faic.total_token_output_count) as direct_tokens,\n    SUM(faic.total_token_cache_read_count + faic.total_token_cache_create_count) as cache_tokens,\n    ROUND(100.0 * SUM(faic.total_token_cache_read_count + faic.total_token_cache_create_count) /\n        NULLIF(SUM(faic.total_token_input_count + faic.total_token_output_count + faic.total_token_cache_read_count + faic.total_token_cache_create_count), 0), 1) as cache_ratio\nFROM herd.dim_date dd\nLEFT JOIN herd.fact_agent_instance_work faiw\n    ON CAST(strftime(faiw.agent_instance_started_at, '%Y%m%d') AS INTEGER) = dd.date_sk\nLEFT JOIN herd.fact_agent_instance_cost faic\n    ON faiw.agent_instance_tk = faic.agent_instance_tk\nWHERE dd.date_actual >= CURRENT_DATE - INTERVAL '30 days'\n  AND dd.date_actual <= CURRENT_DATE\nGROUP BY dd.date_actual\nORDER BY dd.date_actual","inputQueryString":"SELECT\n    dd.date_actual as date,\n    SUM(faic.total_token_input_count + faic.total_token_output_count) as direct_tokens,\n    SUM(faic.total_token_cache_read_count + faic.total_token_cache_create_count) as cache_tokens,\n    ROUND(100.0 * SUM(faic.total_token_cache_read_count + faic.total_token_cache_create_count) /\n        NULLIF(SUM(faic.total_token_input_count + faic.total_token_output_count + faic.total_token_cache_read_count + faic.total_token_cache_create_count), 0), 1) as cache_ratio\nFROM herd.dim_date dd\nLEFT JOIN herd.fact_agent_instance_work faiw\n    ON CAST(strftime(faiw.agent_instance_started_at, '%Y%m%d') AS INTEGER) = dd.date_sk\nLEFT JOIN herd.fact_agent_instance_cost faic\n    ON faiw.agent_instance_tk = faic.agent_instance_tk\nWHERE dd.date_actual >= CURRENT_DATE - INTERVAL '30 days'\n  AND dd.date_actual <= CURRENT_DATE\nGROUP BY dd.date_actual\nORDER BY dd.date_actual","compiled":false,"inline":true},{"id":"cost_per_line","compiledQueryString":"SELECT\n    dd.date_actual as date,\n    SUM(fpd.pr_lines_added + fpd.pr_lines_deleted) as total_lines,\n    SUM(faic.total_token_cost_usd) as total_cost,\n    CASE\n        WHEN SUM(fpd.pr_lines_added + fpd.pr_lines_deleted) > 0\n        THEN SUM(faic.total_token_cost_usd) / SUM(fpd.pr_lines_added + fpd.pr_lines_deleted)\n        ELSE 0\n    END as cost_per_line\nFROM herd.dim_date dd\nLEFT JOIN herd.fact_pr_delivery fpd\n    ON CAST(strftime(fpd.pr_merged_at, '%Y%m%d') AS INTEGER) = dd.date_sk\nLEFT JOIN herd.fact_agent_instance_cost faic\n    ON fpd.agent_sk = faic.agent_sk\nWHERE dd.date_actual >= CURRENT_DATE - INTERVAL '30 days'\n  AND dd.date_actual <= CURRENT_DATE\n  AND fpd.pr_merged_at IS NOT NULL\nGROUP BY dd.date_actual\nHAVING SUM(fpd.pr_lines_added + fpd.pr_lines_deleted) > 0\nORDER BY dd.date_actual","inputQueryString":"SELECT\n    dd.date_actual as date,\n    SUM(fpd.pr_lines_added + fpd.pr_lines_deleted) as total_lines,\n    SUM(faic.total_token_cost_usd) as total_cost,\n    CASE\n        WHEN SUM(fpd.pr_lines_added + fpd.pr_lines_deleted) > 0\n        THEN SUM(faic.total_token_cost_usd) / SUM(fpd.pr_lines_added + fpd.pr_lines_deleted)\n        ELSE 0\n    END as cost_per_line\nFROM herd.dim_date dd\nLEFT JOIN herd.fact_pr_delivery fpd\n    ON CAST(strftime(fpd.pr_merged_at, '%Y%m%d') AS INTEGER) = dd.date_sk\nLEFT JOIN herd.fact_agent_instance_cost faic\n    ON fpd.agent_sk = faic.agent_sk\nWHERE dd.date_actual >= CURRENT_DATE - INTERVAL '30 days'\n  AND dd.date_actual <= CURRENT_DATE\n  AND fpd.pr_merged_at IS NOT NULL\nGROUP BY dd.date_actual\nHAVING SUM(fpd.pr_lines_added + fpd.pr_lines_deleted) > 0\nORDER BY dd.date_actual","compiled":false,"inline":true},{"id":"cost_projection","compiledQueryString":"WITH recent_costs AS (\n    SELECT\n        dd.date_actual,\n        COALESCE(SUM(faic.total_token_cost_usd), 0) as daily_cost\n    FROM herd.dim_date dd\n    LEFT JOIN herd.fact_agent_instance_work faiw\n        ON CAST(strftime(faiw.agent_instance_started_at, '%Y%m%d') AS INTEGER) = dd.date_sk\n    LEFT JOIN herd.fact_agent_instance_cost faic\n        ON faiw.agent_instance_tk = faic.agent_instance_tk\n    WHERE dd.date_actual >= CURRENT_DATE - INTERVAL '30 days'\n      AND dd.date_actual < CURRENT_DATE\n    GROUP BY dd.date_actual\n)\nSELECT\n    AVG(daily_cost) as avg_daily_cost,\n    AVG(daily_cost) * 30 as projected_monthly_cost,\n    AVG(daily_cost) * 365 as projected_annual_cost\nFROM recent_costs","inputQueryString":"WITH recent_costs AS (\n    SELECT\n        dd.date_actual,\n        COALESCE(SUM(faic.total_token_cost_usd), 0) as daily_cost\n    FROM herd.dim_date dd\n    LEFT JOIN herd.fact_agent_instance_work faiw\n        ON CAST(strftime(faiw.agent_instance_started_at, '%Y%m%d') AS INTEGER) = dd.date_sk\n    LEFT JOIN herd.fact_agent_instance_cost faic\n        ON faiw.agent_instance_tk = faic.agent_instance_tk\n    WHERE dd.date_actual >= CURRENT_DATE - INTERVAL '30 days'\n      AND dd.date_actual < CURRENT_DATE\n    GROUP BY dd.date_actual\n)\nSELECT\n    AVG(daily_cost) as avg_daily_cost,\n    AVG(daily_cost) * 30 as projected_monthly_cost,\n    AVG(daily_cost) * 365 as projected_annual_cost\nFROM recent_costs","compiled":false,"inline":true},{"id":"expensive_tickets","compiledQueryString":"SELECT\n    dt.ticket_code,\n    dt.ticket_title,\n    dt.ticket_tshirt_size,\n    COUNT(DISTINCT faic.agent_instance_tk) as sessions,\n    SUM(faic.total_token_input_count + faic.total_token_output_count) as total_tokens,\n    SUM(faic.total_token_cost_usd) as total_cost\nFROM herd.dim_ticket dt\nJOIN herd.fact_agent_instance_cost faic\n    ON dt.ticket_sk = faic.ticket_sk\nWHERE dt.is_current = true\n  AND NOT dt.is_deleted\nGROUP BY dt.ticket_code, dt.ticket_title, dt.ticket_tshirt_size\nORDER BY total_cost DESC\nLIMIT 20","inputQueryString":"SELECT\n    dt.ticket_code,\n    dt.ticket_title,\n    dt.ticket_tshirt_size,\n    COUNT(DISTINCT faic.agent_instance_tk) as sessions,\n    SUM(faic.total_token_input_count + faic.total_token_output_count) as total_tokens,\n    SUM(faic.total_token_cost_usd) as total_cost\nFROM herd.dim_ticket dt\nJOIN herd.fact_agent_instance_cost faic\n    ON dt.ticket_sk = faic.ticket_sk\nWHERE dt.is_current = true\n  AND NOT dt.is_deleted\nGROUP BY dt.ticket_code, dt.ticket_title, dt.ticket_tshirt_size\nORDER BY total_cost DESC\nLIMIT 20","compiled":false,"inline":true}]}