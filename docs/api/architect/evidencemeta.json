{"queries":[{"id":"architect_overview","compiledQueryString":"SELECT\n    COUNT(DISTINCT faiw.agent_instance_tk) as total_sessions,\n    COUNT(DISTINCT dt.ticket_tk) as tickets_coordinated,\n    SUM(faiw.lifecycle_event_count) as lifecycle_events,\n    SUM(faiw.ticket_activity_count) as ticket_activities,\n    SUM(faic.total_token_cost_usd) as total_cost,\n    ROUND(AVG(faiw.instance_duration_minutes), 1) as avg_session_minutes\nFROM herd.dim_agent da\nLEFT JOIN herd.fact_agent_instance_work faiw\n    ON da.agent_sk = faiw.agent_sk\nLEFT JOIN herd.fact_agent_instance_cost faic\n    ON faiw.agent_instance_tk = faic.agent_instance_tk\nLEFT JOIN herd.dim_ticket dt\n    ON faiw.ticket_sk = dt.ticket_sk\nWHERE da.agent_code = 'mini-mao'\n  AND da.is_current = true","inputQueryString":"SELECT\n    COUNT(DISTINCT faiw.agent_instance_tk) as total_sessions,\n    COUNT(DISTINCT dt.ticket_tk) as tickets_coordinated,\n    SUM(faiw.lifecycle_event_count) as lifecycle_events,\n    SUM(faiw.ticket_activity_count) as ticket_activities,\n    SUM(faic.total_token_cost_usd) as total_cost,\n    ROUND(AVG(faiw.instance_duration_minutes), 1) as avg_session_minutes\nFROM herd.dim_agent da\nLEFT JOIN herd.fact_agent_instance_work faiw\n    ON da.agent_sk = faiw.agent_sk\nLEFT JOIN herd.fact_agent_instance_cost faic\n    ON faiw.agent_instance_tk = faic.agent_instance_tk\nLEFT JOIN herd.dim_ticket dt\n    ON faiw.ticket_sk = dt.ticket_sk\nWHERE da.agent_code = 'mini-mao'\n  AND da.is_current = true","compiled":false,"inline":true},{"id":"intervention_trend","compiledQueryString":"SELECT\n    dd.date_actual as date,\n    COUNT(DISTINCT faiw.agent_instance_tk) as sessions,\n    SUM(faiw.lifecycle_event_count) as events,\n    SUM(faic.total_token_cost_usd) as cost\nFROM herd.dim_date dd\nLEFT JOIN herd.fact_agent_instance_work faiw\n    ON CAST(strftime(faiw.agent_instance_started_at, '%Y%m%d') AS INTEGER) = dd.date_sk\nLEFT JOIN herd.dim_agent da\n    ON faiw.agent_sk = da.agent_sk\n    AND da.agent_code = 'mini-mao'\n    AND da.is_current = true\nLEFT JOIN herd.fact_agent_instance_cost faic\n    ON faiw.agent_instance_tk = faic.agent_instance_tk\nWHERE dd.date_actual >= CURRENT_DATE - INTERVAL '30 days'\n  AND dd.date_actual <= CURRENT_DATE\nGROUP BY dd.date_actual\nORDER BY dd.date_actual","inputQueryString":"SELECT\n    dd.date_actual as date,\n    COUNT(DISTINCT faiw.agent_instance_tk) as sessions,\n    SUM(faiw.lifecycle_event_count) as events,\n    SUM(faic.total_token_cost_usd) as cost\nFROM herd.dim_date dd\nLEFT JOIN herd.fact_agent_instance_work faiw\n    ON CAST(strftime(faiw.agent_instance_started_at, '%Y%m%d') AS INTEGER) = dd.date_sk\nLEFT JOIN herd.dim_agent da\n    ON faiw.agent_sk = da.agent_sk\n    AND da.agent_code = 'mini-mao'\n    AND da.is_current = true\nLEFT JOIN herd.fact_agent_instance_cost faic\n    ON faiw.agent_instance_tk = faic.agent_instance_tk\nWHERE dd.date_actual >= CURRENT_DATE - INTERVAL '30 days'\n  AND dd.date_actual <= CURRENT_DATE\nGROUP BY dd.date_actual\nORDER BY dd.date_actual","compiled":false,"inline":true},{"id":"autonomy_ratio","compiledQueryString":"WITH all_work AS (\n    SELECT\n        COUNT(DISTINCT faiw.agent_instance_tk) as total_sessions\n    FROM herd.fact_agent_instance_work faiw\n),\narchitect_work AS (\n    SELECT\n        COUNT(DISTINCT faiw.agent_instance_tk) as architect_sessions\n    FROM herd.fact_agent_instance_work faiw\n    JOIN herd.dim_agent da\n        ON faiw.agent_sk = da.agent_sk\n    WHERE da.agent_code = 'mini-mao'\n      AND da.is_current = true\n)\nSELECT\n    all_work.total_sessions,\n    architect_work.architect_sessions,\n    ROUND(100.0 * (all_work.total_sessions - architect_work.architect_sessions) / NULLIF(all_work.total_sessions, 0), 1) as autonomy_ratio\nFROM all_work, architect_work","inputQueryString":"WITH all_work AS (\n    SELECT\n        COUNT(DISTINCT faiw.agent_instance_tk) as total_sessions\n    FROM herd.fact_agent_instance_work faiw\n),\narchitect_work AS (\n    SELECT\n        COUNT(DISTINCT faiw.agent_instance_tk) as architect_sessions\n    FROM herd.fact_agent_instance_work faiw\n    JOIN herd.dim_agent da\n        ON faiw.agent_sk = da.agent_sk\n    WHERE da.agent_code = 'mini-mao'\n      AND da.is_current = true\n)\nSELECT\n    all_work.total_sessions,\n    architect_work.architect_sessions,\n    ROUND(100.0 * (all_work.total_sessions - architect_work.architect_sessions) / NULLIF(all_work.total_sessions, 0), 1) as autonomy_ratio\nFROM all_work, architect_work","compiled":false,"inline":true},{"id":"tickets_needing_intervention","compiledQueryString":"SELECT\n    dt.ticket_code,\n    dt.ticket_title,\n    dt.ticket_current_status,\n    dt.ticket_tshirt_size,\n    COUNT(DISTINCT faiw.agent_instance_tk) as architect_sessions,\n    SUM(faic.total_token_cost_usd) as intervention_cost,\n    ROUND(SUM(faiw.instance_duration_minutes), 1) as total_minutes\nFROM herd.dim_ticket dt\nJOIN herd.fact_agent_instance_work faiw\n    ON dt.ticket_sk = faiw.ticket_sk\nJOIN herd.dim_agent da\n    ON faiw.agent_sk = da.agent_sk\nLEFT JOIN herd.fact_agent_instance_cost faic\n    ON faiw.agent_instance_tk = faic.agent_instance_tk\nWHERE da.agent_code = 'mini-mao'\n  AND da.is_current = true\n  AND dt.is_current = true\n  AND NOT dt.is_deleted\nGROUP BY dt.ticket_code, dt.ticket_title, dt.ticket_current_status, dt.ticket_tshirt_size\nORDER BY architect_sessions DESC, intervention_cost DESC\nLIMIT 20","inputQueryString":"SELECT\n    dt.ticket_code,\n    dt.ticket_title,\n    dt.ticket_current_status,\n    dt.ticket_tshirt_size,\n    COUNT(DISTINCT faiw.agent_instance_tk) as architect_sessions,\n    SUM(faic.total_token_cost_usd) as intervention_cost,\n    ROUND(SUM(faiw.instance_duration_minutes), 1) as total_minutes\nFROM herd.dim_ticket dt\nJOIN herd.fact_agent_instance_work faiw\n    ON dt.ticket_sk = faiw.ticket_sk\nJOIN herd.dim_agent da\n    ON faiw.agent_sk = da.agent_sk\nLEFT JOIN herd.fact_agent_instance_cost faic\n    ON faiw.agent_instance_tk = faic.agent_instance_tk\nWHERE da.agent_code = 'mini-mao'\n  AND da.is_current = true\n  AND dt.is_current = true\n  AND NOT dt.is_deleted\nGROUP BY dt.ticket_code, dt.ticket_title, dt.ticket_current_status, dt.ticket_tshirt_size\nORDER BY architect_sessions DESC, intervention_cost DESC\nLIMIT 20","compiled":false,"inline":true},{"id":"cost_by_ticket_size","compiledQueryString":"SELECT\n    dt.ticket_tshirt_size,\n    COUNT(DISTINCT dt.ticket_tk) as ticket_count,\n    COUNT(DISTINCT faiw.agent_instance_tk) as sessions,\n    SUM(faic.total_token_cost_usd) as total_cost,\n    ROUND(AVG(faic.total_token_cost_usd), 4) as avg_cost_per_session\nFROM herd.dim_ticket dt\nJOIN herd.fact_agent_instance_work faiw\n    ON dt.ticket_sk = faiw.ticket_sk\nJOIN herd.dim_agent da\n    ON faiw.agent_sk = da.agent_sk\nLEFT JOIN herd.fact_agent_instance_cost faic\n    ON faiw.agent_instance_tk = faic.agent_instance_tk\nWHERE da.agent_code = 'mini-mao'\n  AND da.is_current = true\n  AND dt.is_current = true\n  AND NOT dt.is_deleted\n  AND dt.ticket_tshirt_size IS NOT NULL\nGROUP BY dt.ticket_tshirt_size\nORDER BY\n    CASE dt.ticket_tshirt_size\n        WHEN 'XS' THEN 1\n        WHEN 'S' THEN 2\n        WHEN 'M' THEN 3\n        WHEN 'L' THEN 4\n        WHEN 'XL' THEN 5\n        ELSE 6\n    END","inputQueryString":"SELECT\n    dt.ticket_tshirt_size,\n    COUNT(DISTINCT dt.ticket_tk) as ticket_count,\n    COUNT(DISTINCT faiw.agent_instance_tk) as sessions,\n    SUM(faic.total_token_cost_usd) as total_cost,\n    ROUND(AVG(faic.total_token_cost_usd), 4) as avg_cost_per_session\nFROM herd.dim_ticket dt\nJOIN herd.fact_agent_instance_work faiw\n    ON dt.ticket_sk = faiw.ticket_sk\nJOIN herd.dim_agent da\n    ON faiw.agent_sk = da.agent_sk\nLEFT JOIN herd.fact_agent_instance_cost faic\n    ON faiw.agent_instance_tk = faic.agent_instance_tk\nWHERE da.agent_code = 'mini-mao'\n  AND da.is_current = true\n  AND dt.is_current = true\n  AND NOT dt.is_deleted\n  AND dt.ticket_tshirt_size IS NOT NULL\nGROUP BY dt.ticket_tshirt_size\nORDER BY\n    CASE dt.ticket_tshirt_size\n        WHEN 'XS' THEN 1\n        WHEN 'S' THEN 2\n        WHEN 'M' THEN 3\n        WHEN 'L' THEN 4\n        WHEN 'XL' THEN 5\n        ELSE 6\n    END","compiled":false,"inline":true},{"id":"session_duration","compiledQueryString":"SELECT\n    faiw.instance_duration_minutes as duration,\n    COUNT(*) as count\nFROM herd.fact_agent_instance_work faiw\nJOIN herd.dim_agent da\n    ON faiw.agent_sk = da.agent_sk\nWHERE da.agent_code = 'mini-mao'\n  AND da.is_current = true\n  AND faiw.instance_duration_minutes IS NOT NULL","inputQueryString":"SELECT\n    faiw.instance_duration_minutes as duration,\n    COUNT(*) as count\nFROM herd.fact_agent_instance_work faiw\nJOIN herd.dim_agent da\n    ON faiw.agent_sk = da.agent_sk\nWHERE da.agent_code = 'mini-mao'\n  AND da.is_current = true\n  AND faiw.instance_duration_minutes IS NOT NULL","compiled":false,"inline":true},{"id":"recent_activity","compiledQueryString":"SELECT\n    faiw.agent_instance_started_at,\n    dt.ticket_code,\n    dt.ticket_title,\n    faiw.agent_instance_outcome,\n    faiw.instance_duration_minutes,\n    faic.total_token_cost_usd as cost\nFROM herd.fact_agent_instance_work faiw\nJOIN herd.dim_agent da\n    ON faiw.agent_sk = da.agent_sk\nLEFT JOIN herd.dim_ticket dt\n    ON faiw.ticket_sk = dt.ticket_sk\nLEFT JOIN herd.fact_agent_instance_cost faic\n    ON faiw.agent_instance_tk = faic.agent_instance_tk\nWHERE da.agent_code = 'mini-mao'\n  AND da.is_current = true\nORDER BY faiw.agent_instance_started_at DESC\nLIMIT 50","inputQueryString":"SELECT\n    faiw.agent_instance_started_at,\n    dt.ticket_code,\n    dt.ticket_title,\n    faiw.agent_instance_outcome,\n    faiw.instance_duration_minutes,\n    faic.total_token_cost_usd as cost\nFROM herd.fact_agent_instance_work faiw\nJOIN herd.dim_agent da\n    ON faiw.agent_sk = da.agent_sk\nLEFT JOIN herd.dim_ticket dt\n    ON faiw.ticket_sk = dt.ticket_sk\nLEFT JOIN herd.fact_agent_instance_cost faic\n    ON faiw.agent_instance_tk = faic.agent_instance_tk\nWHERE da.agent_code = 'mini-mao'\n  AND da.is_current = true\nORDER BY faiw.agent_instance_started_at DESC\nLIMIT 50","compiled":false,"inline":true},{"id":"intervention_types","compiledQueryString":"SELECT\n    CASE\n        WHEN faiw.lifecycle_event_count > 0 THEN 'Lifecycle Management'\n        WHEN faiw.ticket_activity_count > 0 THEN 'Ticket Coordination'\n        WHEN faiw.pr_activity_count > 0 THEN 'PR Management'\n        ELSE 'Other'\n    END as intervention_type,\n    COUNT(DISTINCT faiw.agent_instance_tk) as session_count,\n    SUM(faic.total_token_cost_usd) as total_cost\nFROM herd.fact_agent_instance_work faiw\nJOIN herd.dim_agent da\n    ON faiw.agent_sk = da.agent_sk\nLEFT JOIN herd.fact_agent_instance_cost faic\n    ON faiw.agent_instance_tk = faic.agent_instance_tk\nWHERE da.agent_code = 'mini-mao'\n  AND da.is_current = true\nGROUP BY intervention_type\nORDER BY session_count DESC","inputQueryString":"SELECT\n    CASE\n        WHEN faiw.lifecycle_event_count > 0 THEN 'Lifecycle Management'\n        WHEN faiw.ticket_activity_count > 0 THEN 'Ticket Coordination'\n        WHEN faiw.pr_activity_count > 0 THEN 'PR Management'\n        ELSE 'Other'\n    END as intervention_type,\n    COUNT(DISTINCT faiw.agent_instance_tk) as session_count,\n    SUM(faic.total_token_cost_usd) as total_cost\nFROM herd.fact_agent_instance_work faiw\nJOIN herd.dim_agent da\n    ON faiw.agent_sk = da.agent_sk\nLEFT JOIN herd.fact_agent_instance_cost faic\n    ON faiw.agent_instance_tk = faic.agent_instance_tk\nWHERE da.agent_code = 'mini-mao'\n  AND da.is_current = true\nGROUP BY intervention_type\nORDER BY session_count DESC","compiled":false,"inline":true}]}