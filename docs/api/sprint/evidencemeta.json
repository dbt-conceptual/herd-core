{"queries":[{"id":"sprints","compiledQueryString":"SELECT\n    sprint_code,\n    sprint_title,\n    sprint_started_at,\n    sprint_planned_end_at,\n    sprint_actual_end_at,\n    CASE WHEN sprint_actual_end_at IS NULL THEN true ELSE false END as is_active\nFROM herd.dim_sprint\nWHERE is_current = true\n  AND NOT is_deleted\n  AND (sprint_planned_end_at >= CURRENT_DATE - INTERVAL '90 days'\n       OR sprint_actual_end_at >= CURRENT_DATE - INTERVAL '90 days'\n       OR sprint_actual_end_at IS NULL)\nORDER BY sprint_started_at DESC","inputQueryString":"SELECT\n    sprint_code,\n    sprint_title,\n    sprint_started_at,\n    sprint_planned_end_at,\n    sprint_actual_end_at,\n    CASE WHEN sprint_actual_end_at IS NULL THEN true ELSE false END as is_active\nFROM herd.dim_sprint\nWHERE is_current = true\n  AND NOT is_deleted\n  AND (sprint_planned_end_at >= CURRENT_DATE - INTERVAL '90 days'\n       OR sprint_actual_end_at >= CURRENT_DATE - INTERVAL '90 days'\n       OR sprint_actual_end_at IS NULL)\nORDER BY sprint_started_at DESC","compiled":false,"inline":true},{"id":"sprint_summary","compiledQueryString":"SELECT\n    ds.sprint_title,\n    ds.sprint_code,\n    ds.sprint_started_at as start_date,\n    ds.sprint_planned_end_at as end_date,\n    CASE WHEN ds.sprint_actual_end_at IS NULL THEN true ELSE false END as is_active,\n    COUNT(DISTINCT dt.ticket_code) as total_tickets,\n    SUM(CASE WHEN dt.ticket_current_status = 'Done' THEN 1 ELSE 0 END) as completed_tickets,\n    SUM(CASE WHEN dt.ticket_current_status IN ('In Progress', 'In Review', 'PR Submitted', 'QA Review') THEN 1 ELSE 0 END) as in_progress_tickets,\n    SUM(CASE WHEN dt.ticket_current_status IN ('Backlog', 'Todo', 'Assigned') THEN 1 ELSE 0 END) as todo_tickets\nFROM herd.dim_sprint ds\nLEFT JOIN herd.dim_ticket dt\n    ON ds.sprint_code = dt.current_sprint_code\n    AND dt.is_current = true\n    AND NOT dt.is_deleted\nWHERE ds.sprint_code = '${inputs.selected_sprint}'\n  AND ds.is_current = true\nGROUP BY ds.sprint_title, ds.sprint_code, ds.sprint_started_at, ds.sprint_planned_end_at, ds.sprint_actual_end_at","inputQueryString":"SELECT\n    ds.sprint_title,\n    ds.sprint_code,\n    ds.sprint_started_at as start_date,\n    ds.sprint_planned_end_at as end_date,\n    CASE WHEN ds.sprint_actual_end_at IS NULL THEN true ELSE false END as is_active,\n    COUNT(DISTINCT dt.ticket_code) as total_tickets,\n    SUM(CASE WHEN dt.ticket_current_status = 'Done' THEN 1 ELSE 0 END) as completed_tickets,\n    SUM(CASE WHEN dt.ticket_current_status IN ('In Progress', 'In Review', 'PR Submitted', 'QA Review') THEN 1 ELSE 0 END) as in_progress_tickets,\n    SUM(CASE WHEN dt.ticket_current_status IN ('Backlog', 'Todo', 'Assigned') THEN 1 ELSE 0 END) as todo_tickets\nFROM herd.dim_sprint ds\nLEFT JOIN herd.dim_ticket dt\n    ON ds.sprint_code = dt.current_sprint_code\n    AND dt.is_current = true\n    AND NOT dt.is_deleted\nWHERE ds.sprint_code = '${inputs.selected_sprint}'\n  AND ds.is_current = true\nGROUP BY ds.sprint_title, ds.sprint_code, ds.sprint_started_at, ds.sprint_planned_end_at, ds.sprint_actual_end_at","compiled":false,"inline":true},{"id":"burndown","compiledQueryString":"SELECT\n    dd.date_actual as date,\n    COUNT(DISTINCT CASE WHEN fsb.ticket_status NOT IN ('Done', 'Completed', 'Closed') THEN fsb.ticket_tk END) as remaining_tickets,\n    COUNT(DISTINCT CASE WHEN fsb.ticket_status IN ('Done', 'Completed', 'Closed') THEN fsb.ticket_tk END) as completed_tickets\nFROM herd.fact_sprint_burndown fsb\nJOIN herd.dim_date dd\n    ON CAST(strftime(fsb.event_ts, '%Y%m%d') AS INTEGER) = dd.date_sk\nWHERE fsb.sprint_code = '${inputs.selected_sprint}'\nGROUP BY dd.date_actual\nORDER BY dd.date_actual","inputQueryString":"SELECT\n    dd.date_actual as date,\n    COUNT(DISTINCT CASE WHEN fsb.ticket_status NOT IN ('Done', 'Completed', 'Closed') THEN fsb.ticket_tk END) as remaining_tickets,\n    COUNT(DISTINCT CASE WHEN fsb.ticket_status IN ('Done', 'Completed', 'Closed') THEN fsb.ticket_tk END) as completed_tickets\nFROM herd.fact_sprint_burndown fsb\nJOIN herd.dim_date dd\n    ON CAST(strftime(fsb.event_ts, '%Y%m%d') AS INTEGER) = dd.date_sk\nWHERE fsb.sprint_code = '${inputs.selected_sprint}'\nGROUP BY dd.date_actual\nORDER BY dd.date_actual","compiled":false,"inline":true},{"id":"agent_contributions","compiledQueryString":"WITH sprint_window AS (\n    SELECT\n        sprint_started_at,\n        COALESCE(sprint_actual_end_at, sprint_planned_end_at) as sprint_end_at\n    FROM herd.dim_sprint\n    WHERE sprint_code = '${inputs.selected_sprint}'\n      AND is_current = true\n),\npr_metrics AS (\n    SELECT\n        fpd.agent_sk,\n        COUNT(DISTINCT fpd.pull_request_sk) as prs_merged,\n        SUM(fpd.pr_lines_added + fpd.pr_lines_deleted) as total_lines_changed\n    FROM herd.fact_pr_delivery fpd\n    CROSS JOIN sprint_window sw\n    WHERE fpd.pr_merged_at IS NOT NULL\n      AND fpd.pr_merged_at BETWEEN sw.sprint_started_at AND sw.sprint_end_at\n    GROUP BY fpd.agent_sk\n),\ncost_metrics AS (\n    SELECT\n        faic.agent_sk,\n        SUM(faic.total_token_cost_usd) as cost_usd\n    FROM herd.fact_agent_instance_cost faic\n    JOIN herd.dim_ticket dt\n        ON faic.ticket_sk = dt.ticket_sk\n    CROSS JOIN sprint_window sw\n    WHERE dt.is_current = true\n    GROUP BY faic.agent_sk\n)\nSELECT\n    da.agent_code,\n    da.agent_role,\n    COALESCE(pm.prs_merged, 0) as prs_merged,\n    COALESCE(pm.total_lines_changed, 0) as total_lines_changed,\n    COALESCE(cm.cost_usd, 0) as cost_usd\nFROM herd.dim_agent da\nLEFT JOIN pr_metrics pm\n    ON da.agent_sk = pm.agent_sk\nLEFT JOIN cost_metrics cm\n    ON da.agent_sk = cm.agent_sk\nWHERE da.is_current = true\n  AND NOT da.is_deleted\n  AND (pm.prs_merged > 0 OR cm.cost_usd > 0)\nORDER BY cost_usd DESC NULLS LAST","inputQueryString":"WITH sprint_window AS (\n    SELECT\n        sprint_started_at,\n        COALESCE(sprint_actual_end_at, sprint_planned_end_at) as sprint_end_at\n    FROM herd.dim_sprint\n    WHERE sprint_code = '${inputs.selected_sprint}'\n      AND is_current = true\n),\npr_metrics AS (\n    SELECT\n        fpd.agent_sk,\n        COUNT(DISTINCT fpd.pull_request_sk) as prs_merged,\n        SUM(fpd.pr_lines_added + fpd.pr_lines_deleted) as total_lines_changed\n    FROM herd.fact_pr_delivery fpd\n    CROSS JOIN sprint_window sw\n    WHERE fpd.pr_merged_at IS NOT NULL\n      AND fpd.pr_merged_at BETWEEN sw.sprint_started_at AND sw.sprint_end_at\n    GROUP BY fpd.agent_sk\n),\ncost_metrics AS (\n    SELECT\n        faic.agent_sk,\n        SUM(faic.total_token_cost_usd) as cost_usd\n    FROM herd.fact_agent_instance_cost faic\n    JOIN herd.dim_ticket dt\n        ON faic.ticket_sk = dt.ticket_sk\n    CROSS JOIN sprint_window sw\n    WHERE dt.is_current = true\n    GROUP BY faic.agent_sk\n)\nSELECT\n    da.agent_code,\n    da.agent_role,\n    COALESCE(pm.prs_merged, 0) as prs_merged,\n    COALESCE(pm.total_lines_changed, 0) as total_lines_changed,\n    COALESCE(cm.cost_usd, 0) as cost_usd\nFROM herd.dim_agent da\nLEFT JOIN pr_metrics pm\n    ON da.agent_sk = pm.agent_sk\nLEFT JOIN cost_metrics cm\n    ON da.agent_sk = cm.agent_sk\nWHERE da.is_current = true\n  AND NOT da.is_deleted\n  AND (pm.prs_merged > 0 OR cm.cost_usd > 0)\nORDER BY cost_usd DESC NULLS LAST","compiled":false,"inline":true},{"id":"velocity_history","compiledQueryString":"SELECT\n    ds.sprint_title,\n    ds.sprint_code,\n    ds.sprint_started_at as start_date,\n    COUNT(DISTINCT dt.ticket_code) as tickets_completed,\n    COUNT(DISTINCT fpd.pull_request_sk) as prs_merged\nFROM herd.dim_sprint ds\nLEFT JOIN herd.dim_ticket dt\n    ON ds.sprint_code = dt.current_sprint_code\n    AND dt.is_current = true\n    AND NOT dt.is_deleted\n    AND dt.ticket_current_status = 'Done'\nLEFT JOIN herd.fact_pr_delivery fpd\n    ON fpd.pr_merged_at BETWEEN ds.sprint_started_at AND COALESCE(ds.sprint_actual_end_at, ds.sprint_planned_end_at)\nWHERE ds.is_current = true\n  AND NOT ds.is_deleted\n  AND COALESCE(ds.sprint_actual_end_at, ds.sprint_planned_end_at) >= CURRENT_DATE - INTERVAL '180 days'\n  AND COALESCE(ds.sprint_actual_end_at, ds.sprint_planned_end_at) <= CURRENT_DATE\nGROUP BY ds.sprint_title, ds.sprint_code, ds.sprint_started_at\nORDER BY ds.sprint_started_at DESC\nLIMIT 6","inputQueryString":"SELECT\n    ds.sprint_title,\n    ds.sprint_code,\n    ds.sprint_started_at as start_date,\n    COUNT(DISTINCT dt.ticket_code) as tickets_completed,\n    COUNT(DISTINCT fpd.pull_request_sk) as prs_merged\nFROM herd.dim_sprint ds\nLEFT JOIN herd.dim_ticket dt\n    ON ds.sprint_code = dt.current_sprint_code\n    AND dt.is_current = true\n    AND NOT dt.is_deleted\n    AND dt.ticket_current_status = 'Done'\nLEFT JOIN herd.fact_pr_delivery fpd\n    ON fpd.pr_merged_at BETWEEN ds.sprint_started_at AND COALESCE(ds.sprint_actual_end_at, ds.sprint_planned_end_at)\nWHERE ds.is_current = true\n  AND NOT ds.is_deleted\n  AND COALESCE(ds.sprint_actual_end_at, ds.sprint_planned_end_at) >= CURRENT_DATE - INTERVAL '180 days'\n  AND COALESCE(ds.sprint_actual_end_at, ds.sprint_planned_end_at) <= CURRENT_DATE\nGROUP BY ds.sprint_title, ds.sprint_code, ds.sprint_started_at\nORDER BY ds.sprint_started_at DESC\nLIMIT 6","compiled":false,"inline":true},{"id":"sprint_tickets","compiledQueryString":"WITH ticket_assignees AS (\n    SELECT\n        faic.ticket_sk,\n        faic.agent_sk,\n        ROW_NUMBER() OVER (PARTITION BY faic.ticket_sk ORDER BY faic.agent_instance_tk DESC) as rn\n    FROM herd.fact_agent_instance_cost faic\n)\nSELECT\n    dt.ticket_code,\n    dt.ticket_title,\n    dt.ticket_current_status,\n    dt.ticket_tshirt_size,\n    da.agent_code as assignee\nFROM herd.dim_ticket dt\nLEFT JOIN ticket_assignees ta\n    ON dt.ticket_sk = ta.ticket_sk\n    AND ta.rn = 1\nLEFT JOIN herd.dim_agent da\n    ON ta.agent_sk = da.agent_sk\nWHERE dt.current_sprint_code = '${inputs.selected_sprint}'\n  AND dt.is_current = true\n  AND NOT dt.is_deleted\nORDER BY\n    CASE dt.ticket_current_status\n        WHEN 'Done' THEN 3\n        WHEN 'In Review' THEN 1\n        WHEN 'In Progress' THEN 2\n        ELSE 4\n    END,\n    dt.ticket_code","inputQueryString":"WITH ticket_assignees AS (\n    SELECT\n        faic.ticket_sk,\n        faic.agent_sk,\n        ROW_NUMBER() OVER (PARTITION BY faic.ticket_sk ORDER BY faic.agent_instance_tk DESC) as rn\n    FROM herd.fact_agent_instance_cost faic\n)\nSELECT\n    dt.ticket_code,\n    dt.ticket_title,\n    dt.ticket_current_status,\n    dt.ticket_tshirt_size,\n    da.agent_code as assignee\nFROM herd.dim_ticket dt\nLEFT JOIN ticket_assignees ta\n    ON dt.ticket_sk = ta.ticket_sk\n    AND ta.rn = 1\nLEFT JOIN herd.dim_agent da\n    ON ta.agent_sk = da.agent_sk\nWHERE dt.current_sprint_code = '${inputs.selected_sprint}'\n  AND dt.is_current = true\n  AND NOT dt.is_deleted\nORDER BY\n    CASE dt.ticket_current_status\n        WHEN 'Done' THEN 3\n        WHEN 'In Review' THEN 1\n        WHEN 'In Progress' THEN 2\n        ELSE 4\n    END,\n    dt.ticket_code","compiled":false,"inline":true},{"id":"recent_activity","compiledQueryString":"SELECT\n    fsb.event_ts,\n    dt.ticket_code,\n    dt.ticket_title,\n    fsb.ticket_status,\n    fsb.ticket_event_type\nFROM herd.fact_sprint_burndown fsb\nJOIN herd.dim_ticket dt\n    ON fsb.ticket_sk = dt.ticket_sk\nWHERE fsb.sprint_code = '${inputs.selected_sprint}'\nORDER BY fsb.event_ts DESC\nLIMIT 20","inputQueryString":"SELECT\n    fsb.event_ts,\n    dt.ticket_code,\n    dt.ticket_title,\n    fsb.ticket_status,\n    fsb.ticket_event_type\nFROM herd.fact_sprint_burndown fsb\nJOIN herd.dim_ticket dt\n    ON fsb.ticket_sk = dt.ticket_sk\nWHERE fsb.sprint_code = '${inputs.selected_sprint}'\nORDER BY fsb.event_ts DESC\nLIMIT 20","compiled":false,"inline":true}]}