{"queries":[{"id":"active_agents","compiledQueryString":"SELECT\n    COUNT(DISTINCT agent_code) as total_agents,\n    SUM(CASE WHEN agent_status = 'Active' THEN 1 ELSE 0 END) as active_agents,\n    SUM(CASE WHEN agent_status = 'Idle' THEN 1 ELSE 0 END) as idle_agents,\n    SUM(CASE WHEN agent_status = 'Blocked' THEN 1 ELSE 0 END) as blocked_agents\nFROM herd.dim_agent\nWHERE is_current = true AND NOT is_deleted","inputQueryString":"SELECT\n    COUNT(DISTINCT agent_code) as total_agents,\n    SUM(CASE WHEN agent_status = 'Active' THEN 1 ELSE 0 END) as active_agents,\n    SUM(CASE WHEN agent_status = 'Idle' THEN 1 ELSE 0 END) as idle_agents,\n    SUM(CASE WHEN agent_status = 'Blocked' THEN 1 ELSE 0 END) as blocked_agents\nFROM herd.dim_agent\nWHERE is_current = true AND NOT is_deleted","compiled":false,"inline":true},{"id":"open_tickets","compiledQueryString":"SELECT COUNT(*) as count\nFROM herd.dim_ticket\nWHERE is_current = true\n  AND NOT is_deleted\n  AND ticket_current_status NOT IN ('Done', 'Canceled', 'Cancelled', 'Archived')","inputQueryString":"SELECT COUNT(*) as count\nFROM herd.dim_ticket\nWHERE is_current = true\n  AND NOT is_deleted\n  AND ticket_current_status NOT IN ('Done', 'Canceled', 'Cancelled', 'Archived')","compiled":false,"inline":true},{"id":"prs_this_week","compiledQueryString":"SELECT COUNT(*) as count\nFROM herd.fact_pr_delivery fpd\nJOIN herd.dim_date dd ON CAST(strftime(fpd.pr_merged_at, '%Y%m%d') AS INTEGER) = dd.date_sk\nWHERE dd.date_actual >= DATE_TRUNC('week', CURRENT_DATE)\n  AND fpd.pr_merged_at IS NOT NULL","inputQueryString":"SELECT COUNT(*) as count\nFROM herd.fact_pr_delivery fpd\nJOIN herd.dim_date dd ON CAST(strftime(fpd.pr_merged_at, '%Y%m%d') AS INTEGER) = dd.date_sk\nWHERE dd.date_actual >= DATE_TRUNC('week', CURRENT_DATE)\n  AND fpd.pr_merged_at IS NOT NULL","compiled":false,"inline":true},{"id":"cost_this_week","compiledQueryString":"SELECT COALESCE(SUM(total_token_cost_usd), 0) as total_cost\nFROM herd.fact_agent_instance_cost","inputQueryString":"SELECT COALESCE(SUM(total_token_cost_usd), 0) as total_cost\nFROM herd.fact_agent_instance_cost","compiled":false,"inline":true},{"id":"cost_per_line","compiledQueryString":"SELECT\n    CASE\n        WHEN SUM(fpd.pr_lines_added + fpd.pr_lines_deleted) > 0\n        THEN SUM(faic.total_token_cost_usd) / SUM(fpd.pr_lines_added + fpd.pr_lines_deleted)\n        ELSE 0\n    END as cost_per_line\nFROM herd.fact_pr_delivery fpd\nLEFT JOIN herd.fact_agent_instance_cost faic\n    ON fpd.agent_sk = faic.agent_sk\nWHERE fpd.pr_merged_at >= CURRENT_DATE - INTERVAL '7 days'","inputQueryString":"SELECT\n    CASE\n        WHEN SUM(fpd.pr_lines_added + fpd.pr_lines_deleted) > 0\n        THEN SUM(faic.total_token_cost_usd) / SUM(fpd.pr_lines_added + fpd.pr_lines_deleted)\n        ELSE 0\n    END as cost_per_line\nFROM herd.fact_pr_delivery fpd\nLEFT JOIN herd.fact_agent_instance_cost faic\n    ON fpd.agent_sk = faic.agent_sk\nWHERE fpd.pr_merged_at >= CURRENT_DATE - INTERVAL '7 days'","compiled":false,"inline":true},{"id":"agent_work_summary","compiledQueryString":"SELECT\n    da.agent_code,\n    da.agent_role,\n    da.agent_status,\n    SUM(faic.total_token_input_count + faic.total_token_output_count) as tokens_used,\n    SUM(faic.total_token_cost_usd) as cost_usd,\n    COUNT(DISTINCT faic.agent_instance_tk) as instances\nFROM herd.dim_agent da\nLEFT JOIN herd.fact_agent_instance_cost faic\n    ON da.agent_sk = faic.agent_sk\nWHERE da.is_current = true AND NOT da.is_deleted\nGROUP BY\n    da.agent_code,\n    da.agent_role,\n    da.agent_status\nORDER BY cost_usd DESC NULLS LAST, da.agent_code","inputQueryString":"SELECT\n    da.agent_code,\n    da.agent_role,\n    da.agent_status,\n    SUM(faic.total_token_input_count + faic.total_token_output_count) as tokens_used,\n    SUM(faic.total_token_cost_usd) as cost_usd,\n    COUNT(DISTINCT faic.agent_instance_tk) as instances\nFROM herd.dim_agent da\nLEFT JOIN herd.fact_agent_instance_cost faic\n    ON da.agent_sk = faic.agent_sk\nWHERE da.is_current = true AND NOT da.is_deleted\nGROUP BY\n    da.agent_code,\n    da.agent_role,\n    da.agent_status\nORDER BY cost_usd DESC NULLS LAST, da.agent_code","compiled":false,"inline":true},{"id":"cost_trends","compiledQueryString":"SELECT\n    dd.date_actual as date,\n    COALESCE(SUM(faic.total_token_cost_usd), 0) as daily_cost,\n    SUM(COALESCE(SUM(faic.total_token_cost_usd), 0)) OVER (\n        ORDER BY dd.date_actual\n        ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW\n    ) as cumulative_cost\nFROM herd.dim_date dd\nLEFT JOIN herd.fact_agent_instance_work faiw\n    ON CAST(strftime(faiw.agent_instance_started_at, '%Y%m%d') AS INTEGER) = dd.date_sk\nLEFT JOIN herd.fact_agent_instance_cost faic\n    ON faiw.agent_instance_tk = faic.agent_instance_tk\nWHERE dd.date_actual >= CURRENT_DATE - INTERVAL '30 days'\n  AND dd.date_actual <= CURRENT_DATE\nGROUP BY dd.date_actual\nORDER BY dd.date_actual","inputQueryString":"SELECT\n    dd.date_actual as date,\n    COALESCE(SUM(faic.total_token_cost_usd), 0) as daily_cost,\n    SUM(COALESCE(SUM(faic.total_token_cost_usd), 0)) OVER (\n        ORDER BY dd.date_actual\n        ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW\n    ) as cumulative_cost\nFROM herd.dim_date dd\nLEFT JOIN herd.fact_agent_instance_work faiw\n    ON CAST(strftime(faiw.agent_instance_started_at, '%Y%m%d') AS INTEGER) = dd.date_sk\nLEFT JOIN herd.fact_agent_instance_cost faic\n    ON faiw.agent_instance_tk = faic.agent_instance_tk\nWHERE dd.date_actual >= CURRENT_DATE - INTERVAL '30 days'\n  AND dd.date_actual <= CURRENT_DATE\nGROUP BY dd.date_actual\nORDER BY dd.date_actual","compiled":false,"inline":true},{"id":"recent_prs","compiledQueryString":"SELECT\n    dpr.pr_code,\n    dpr.pr_title,\n    da.agent_code,\n    fpd.pr_merged_at as merged_date,\n    fpd.pr_lines_added as lines_added,\n    fpd.pr_lines_deleted as lines_deleted,\n    fpd.pr_files_changed as files_changed\nFROM herd.fact_pr_delivery fpd\nJOIN herd.dim_pull_request dpr\n    ON fpd.pull_request_sk = dpr.pull_request_sk\nLEFT JOIN herd.dim_agent da\n    ON fpd.agent_sk = da.agent_sk\nWHERE fpd.pr_merged_at >= CURRENT_DATE - INTERVAL '7 days'\n  AND fpd.pr_merged_at IS NOT NULL\nORDER BY fpd.pr_merged_at DESC\nLIMIT 10","inputQueryString":"SELECT\n    dpr.pr_code,\n    dpr.pr_title,\n    da.agent_code,\n    fpd.pr_merged_at as merged_date,\n    fpd.pr_lines_added as lines_added,\n    fpd.pr_lines_deleted as lines_deleted,\n    fpd.pr_files_changed as files_changed\nFROM herd.fact_pr_delivery fpd\nJOIN herd.dim_pull_request dpr\n    ON fpd.pull_request_sk = dpr.pull_request_sk\nLEFT JOIN herd.dim_agent da\n    ON fpd.agent_sk = da.agent_sk\nWHERE fpd.pr_merged_at >= CURRENT_DATE - INTERVAL '7 days'\n  AND fpd.pr_merged_at IS NOT NULL\nORDER BY fpd.pr_merged_at DESC\nLIMIT 10","compiled":false,"inline":true},{"id":"agent_status_summary","compiledQueryString":"SELECT\n    agent_status,\n    COUNT(*) as agent_count\nFROM herd.dim_agent\nWHERE is_current = true AND NOT is_deleted\nGROUP BY agent_status\nORDER BY agent_count DESC","inputQueryString":"SELECT\n    agent_status,\n    COUNT(*) as agent_count\nFROM herd.dim_agent\nWHERE is_current = true AND NOT is_deleted\nGROUP BY agent_status\nORDER BY agent_count DESC","compiled":false,"inline":true}]}