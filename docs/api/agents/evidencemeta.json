{"queries":[{"id":"agent_summary","compiledQueryString":"SELECT\n    da.agent_code,\n    da.agent_role,\n    da.agent_status,\n    COUNT(DISTINCT faiw.agent_instance_tk) as total_sessions,\n    COUNT(DISTINCT CASE WHEN faiw.agent_instance_outcome = 'success' THEN faiw.agent_instance_tk END) as successful_sessions,\n    COUNT(DISTINCT dt.ticket_tk) as tickets_worked,\n    SUM(faic.total_token_input_count + faic.total_token_output_count) as total_tokens,\n    SUM(faic.total_token_cost_usd) as total_cost,\n    ROUND(AVG(faiw.instance_duration_minutes), 1) as avg_session_minutes\nFROM herd.dim_agent da\nLEFT JOIN herd.fact_agent_instance_work faiw\n    ON da.agent_sk = faiw.agent_sk\nLEFT JOIN herd.fact_agent_instance_cost faic\n    ON faiw.agent_instance_tk = faic.agent_instance_tk\nLEFT JOIN herd.dim_ticket dt\n    ON faiw.ticket_sk = dt.ticket_sk\nWHERE da.is_current = true\n  AND NOT da.is_deleted\nGROUP BY da.agent_code, da.agent_role, da.agent_status\nORDER BY total_cost DESC NULLS LAST","inputQueryString":"SELECT\n    da.agent_code,\n    da.agent_role,\n    da.agent_status,\n    COUNT(DISTINCT faiw.agent_instance_tk) as total_sessions,\n    COUNT(DISTINCT CASE WHEN faiw.agent_instance_outcome = 'success' THEN faiw.agent_instance_tk END) as successful_sessions,\n    COUNT(DISTINCT dt.ticket_tk) as tickets_worked,\n    SUM(faic.total_token_input_count + faic.total_token_output_count) as total_tokens,\n    SUM(faic.total_token_cost_usd) as total_cost,\n    ROUND(AVG(faiw.instance_duration_minutes), 1) as avg_session_minutes\nFROM herd.dim_agent da\nLEFT JOIN herd.fact_agent_instance_work faiw\n    ON da.agent_sk = faiw.agent_sk\nLEFT JOIN herd.fact_agent_instance_cost faic\n    ON faiw.agent_instance_tk = faic.agent_instance_tk\nLEFT JOIN herd.dim_ticket dt\n    ON faiw.ticket_sk = dt.ticket_sk\nWHERE da.is_current = true\n  AND NOT da.is_deleted\nGROUP BY da.agent_code, da.agent_role, da.agent_status\nORDER BY total_cost DESC NULLS LAST","compiled":false,"inline":true},{"id":"qa_pass_rates","compiledQueryString":"SELECT\n    da.agent_code,\n    da.agent_role,\n    COUNT(DISTINCT frq.review_submission_tk) as total_reviews,\n    SUM(CASE WHEN frq.review_round = 1 AND frq.review_verdict = 'approved' THEN 1 ELSE 0 END) as first_pass_approvals,\n    SUM(CASE WHEN frq.review_verdict = 'approved' THEN 1 ELSE 0 END) as total_approvals,\n    ROUND(100.0 * SUM(CASE WHEN frq.review_round = 1 AND frq.review_verdict = 'approved' THEN 1 ELSE 0 END) / NULLIF(COUNT(DISTINCT CASE WHEN frq.review_round = 1 THEN frq.review_submission_tk END), 0), 1) as first_pass_rate,\n    ROUND(AVG(frq.finding_count), 1) as avg_findings_per_review\nFROM herd.dim_agent da\nLEFT JOIN herd.fact_review_quality frq\n    ON da.agent_sk = frq.agent_sk\nWHERE da.is_current = true\n  AND NOT da.is_deleted\n  AND frq.review_submission_tk IS NOT NULL\nGROUP BY da.agent_code, da.agent_role\nORDER BY first_pass_rate DESC NULLS LAST","inputQueryString":"SELECT\n    da.agent_code,\n    da.agent_role,\n    COUNT(DISTINCT frq.review_submission_tk) as total_reviews,\n    SUM(CASE WHEN frq.review_round = 1 AND frq.review_verdict = 'approved' THEN 1 ELSE 0 END) as first_pass_approvals,\n    SUM(CASE WHEN frq.review_verdict = 'approved' THEN 1 ELSE 0 END) as total_approvals,\n    ROUND(100.0 * SUM(CASE WHEN frq.review_round = 1 AND frq.review_verdict = 'approved' THEN 1 ELSE 0 END) / NULLIF(COUNT(DISTINCT CASE WHEN frq.review_round = 1 THEN frq.review_submission_tk END), 0), 1) as first_pass_rate,\n    ROUND(AVG(frq.finding_count), 1) as avg_findings_per_review\nFROM herd.dim_agent da\nLEFT JOIN herd.fact_review_quality frq\n    ON da.agent_sk = frq.agent_sk\nWHERE da.is_current = true\n  AND NOT da.is_deleted\n  AND frq.review_submission_tk IS NOT NULL\nGROUP BY da.agent_code, da.agent_role\nORDER BY first_pass_rate DESC NULLS LAST","compiled":false,"inline":true},{"id":"cost_efficiency","compiledQueryString":"SELECT\n    da.agent_code,\n    dm.model_code,\n    COUNT(DISTINCT fpd.pull_request_sk) as prs_delivered,\n    SUM(fpd.pr_lines_added + fpd.pr_lines_deleted) as total_lines,\n    SUM(faic.total_token_cost_usd) as total_cost,\n    CASE\n        WHEN SUM(fpd.pr_lines_added + fpd.pr_lines_deleted) > 0\n        THEN SUM(faic.total_token_cost_usd) / SUM(fpd.pr_lines_added + fpd.pr_lines_deleted)\n        ELSE 0\n    END as cost_per_line\nFROM herd.dim_agent da\nLEFT JOIN herd.fact_agent_instance_cost faic\n    ON da.agent_sk = faic.agent_sk\nLEFT JOIN herd.dim_model dm\n    ON faic.model_sk = dm.model_sk\nLEFT JOIN herd.fact_pr_delivery fpd\n    ON faic.agent_sk = fpd.agent_sk\nWHERE da.is_current = true\n  AND NOT da.is_deleted\n  AND fpd.pr_merged_at IS NOT NULL\nGROUP BY da.agent_code, dm.model_code\nHAVING SUM(fpd.pr_lines_added + fpd.pr_lines_deleted) > 0\nORDER BY cost_per_line ASC","inputQueryString":"SELECT\n    da.agent_code,\n    dm.model_code,\n    COUNT(DISTINCT fpd.pull_request_sk) as prs_delivered,\n    SUM(fpd.pr_lines_added + fpd.pr_lines_deleted) as total_lines,\n    SUM(faic.total_token_cost_usd) as total_cost,\n    CASE\n        WHEN SUM(fpd.pr_lines_added + fpd.pr_lines_deleted) > 0\n        THEN SUM(faic.total_token_cost_usd) / SUM(fpd.pr_lines_added + fpd.pr_lines_deleted)\n        ELSE 0\n    END as cost_per_line\nFROM herd.dim_agent da\nLEFT JOIN herd.fact_agent_instance_cost faic\n    ON da.agent_sk = faic.agent_sk\nLEFT JOIN herd.dim_model dm\n    ON faic.model_sk = dm.model_sk\nLEFT JOIN herd.fact_pr_delivery fpd\n    ON faic.agent_sk = fpd.agent_sk\nWHERE da.is_current = true\n  AND NOT da.is_deleted\n  AND fpd.pr_merged_at IS NOT NULL\nGROUP BY da.agent_code, dm.model_code\nHAVING SUM(fpd.pr_lines_added + fpd.pr_lines_deleted) > 0\nORDER BY cost_per_line ASC","compiled":false,"inline":true},{"id":"model_usage","compiledQueryString":"SELECT\n    da.agent_code,\n    dm.model_code,\n    dm.model_provider,\n    COUNT(DISTINCT faic.agent_instance_tk) as sessions,\n    SUM(faic.total_token_input_count + faic.total_token_output_count) as total_tokens,\n    SUM(faic.total_token_cost_usd) as total_cost,\n    ROUND(AVG(faic.total_token_cost_usd), 4) as avg_cost_per_session\nFROM herd.dim_agent da\nJOIN herd.fact_agent_instance_cost faic\n    ON da.agent_sk = faic.agent_sk\nJOIN herd.dim_model dm\n    ON faic.model_sk = dm.model_sk\nWHERE da.is_current = true\n  AND NOT da.is_deleted\nGROUP BY da.agent_code, dm.model_code, dm.model_provider\nORDER BY da.agent_code, total_cost DESC","inputQueryString":"SELECT\n    da.agent_code,\n    dm.model_code,\n    dm.model_provider,\n    COUNT(DISTINCT faic.agent_instance_tk) as sessions,\n    SUM(faic.total_token_input_count + faic.total_token_output_count) as total_tokens,\n    SUM(faic.total_token_cost_usd) as total_cost,\n    ROUND(AVG(faic.total_token_cost_usd), 4) as avg_cost_per_session\nFROM herd.dim_agent da\nJOIN herd.fact_agent_instance_cost faic\n    ON da.agent_sk = faic.agent_sk\nJOIN herd.dim_model dm\n    ON faic.model_sk = dm.model_sk\nWHERE da.is_current = true\n  AND NOT da.is_deleted\nGROUP BY da.agent_code, dm.model_code, dm.model_provider\nORDER BY da.agent_code, total_cost DESC","compiled":false,"inline":true},{"id":"agent_crafts","compiledQueryString":"SELECT\n    da.agent_code,\n    da.agent_role,\n    dc.craft_code,\n    dc.craft_description,\n    COUNT(DISTINCT faiw.agent_instance_tk) as instance_count\nFROM herd.dim_agent da\nLEFT JOIN herd.fact_agent_instance_work faiw\n    ON da.agent_sk = faiw.agent_sk\nLEFT JOIN herd.dim_craft dc\n    ON faiw.craft_sk = dc.craft_sk\nWHERE da.is_current = true\n  AND NOT da.is_deleted\n  AND dc.craft_code IS NOT NULL\nGROUP BY da.agent_code, da.agent_role, dc.craft_code, dc.craft_description\nORDER BY da.agent_code, instance_count DESC","inputQueryString":"SELECT\n    da.agent_code,\n    da.agent_role,\n    dc.craft_code,\n    dc.craft_description,\n    COUNT(DISTINCT faiw.agent_instance_tk) as instance_count\nFROM herd.dim_agent da\nLEFT JOIN herd.fact_agent_instance_work faiw\n    ON da.agent_sk = faiw.agent_sk\nLEFT JOIN herd.dim_craft dc\n    ON faiw.craft_sk = dc.craft_sk\nWHERE da.is_current = true\n  AND NOT da.is_deleted\n  AND dc.craft_code IS NOT NULL\nGROUP BY da.agent_code, da.agent_role, dc.craft_code, dc.craft_description\nORDER BY da.agent_code, instance_count DESC","compiled":false,"inline":true},{"id":"work_distribution","compiledQueryString":"SELECT\n    da.agent_code,\n    COUNT(DISTINCT faiw.agent_instance_tk) as session_count,\n    SUM(faiw.instance_duration_minutes) as total_minutes,\n    SUM(faiw.lifecycle_event_count) as lifecycle_events,\n    SUM(faiw.ticket_activity_count) as ticket_activities,\n    SUM(faiw.pr_activity_count) as pr_activities\nFROM herd.dim_agent da\nLEFT JOIN herd.fact_agent_instance_work faiw\n    ON da.agent_sk = faiw.agent_sk\nWHERE da.is_current = true\n  AND NOT da.is_deleted\nGROUP BY da.agent_code\nORDER BY total_minutes DESC NULLS LAST","inputQueryString":"SELECT\n    da.agent_code,\n    COUNT(DISTINCT faiw.agent_instance_tk) as session_count,\n    SUM(faiw.instance_duration_minutes) as total_minutes,\n    SUM(faiw.lifecycle_event_count) as lifecycle_events,\n    SUM(faiw.ticket_activity_count) as ticket_activities,\n    SUM(faiw.pr_activity_count) as pr_activities\nFROM herd.dim_agent da\nLEFT JOIN herd.fact_agent_instance_work faiw\n    ON da.agent_sk = faiw.agent_sk\nWHERE da.is_current = true\n  AND NOT da.is_deleted\nGROUP BY da.agent_code\nORDER BY total_minutes DESC NULLS LAST","compiled":false,"inline":true}]}